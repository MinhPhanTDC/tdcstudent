# Phase 4: Tracking & Progress

**Thá»i gian**: 2-3 tuáº§n  
**Má»¥c tiÃªu**: Admin tracking tiáº¿n Ä‘á»™ há»c viÃªn

---

## Tá»•ng quan

Phase nÃ y xÃ¢y dá»±ng há»‡ thá»‘ng tracking Ä‘á»ƒ Admin:
- Theo dÃµi tiáº¿n Ä‘á»™ há»c viÃªn theo mÃ´n
- Cáº­p nháº­t sá»‘ buá»•i/dá»± Ã¡n hoÃ n thÃ nh
- Pass/Fail há»c viÃªn
- Má»Ÿ khÃ³a mÃ´n/há»c ká»³ tiáº¿p theo

---

## Tasks chi tiáº¿t

### 4.1 Báº£ng tracking há»c viÃªn theo mÃ´n (Priority: HIGH)

**MÃ´ táº£**: Admin xem vÃ  quáº£n lÃ½ tiáº¿n Ä‘á»™ há»c viÃªn

**Subtasks**:
- [ ] Trang tracking (`/tracking`)
- [ ] Filter theo há»c ká»³ vÃ  mÃ´n há»c
- [ ] Báº£ng danh sÃ¡ch há»c viÃªn vá»›i tiáº¿n Ä‘á»™
- [ ] Columns: TÃªn, Email, Sá»‘ buá»•i, Sá»‘ dá»± Ã¡n, Link káº¿t quáº£, Tráº¡ng thÃ¡i
- [ ] Sort theo cÃ¡c columns
- [ ] Search há»c viÃªn
- [ ] Pagination

**UI Layout**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Tracking Há»c viÃªn                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  Há»c ká»³: [Há»c ká»³ 1 â–¼]    MÃ´n há»c: [Design Fundamentals â–¼]          â”‚
â”‚  TÃ¬m kiáº¿m: [________________]                                       â”‚
â”‚                                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ # â”‚ Há»c viÃªn        â”‚ Buá»•i  â”‚ Dá»± Ã¡n â”‚ Link káº¿t quáº£    â”‚ Tráº¡ng thÃ¡i â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1 â”‚ Nguyá»…n VÄƒn A    â”‚ 10/10 â”‚ 2/2   â”‚ [View]          â”‚ âœ“ Pass     â”‚
â”‚ 2 â”‚ Tráº§n Thá»‹ B      â”‚ 8/10  â”‚ 1/2   â”‚ [View]          â”‚ ğŸ”„ Äang há»câ”‚
â”‚ 3 â”‚ LÃª VÄƒn C        â”‚ 10/10 â”‚ 2/2   â”‚ [View]          â”‚ â³ Chá» duyá»‡tâ”‚
â”‚ 4 â”‚ Pháº¡m Thá»‹ D      â”‚ 5/10  â”‚ 0/2   â”‚ -               â”‚ ğŸ”„ Äang há»câ”‚
â”œâ”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                              [1] [2] [3] ... [10]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Components**:
```
apps/admin/src/
â”œâ”€â”€ app/(dashboard)/tracking/
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ components/features/tracking/
â”‚   â”œâ”€â”€ TrackingTable.tsx
â”‚   â”œâ”€â”€ TrackingFilters.tsx
â”‚   â”œâ”€â”€ TrackingRow.tsx
â”‚   â”œâ”€â”€ TrackingActions.tsx
â”‚   â””â”€â”€ index.ts
â””â”€â”€ hooks/
    â””â”€â”€ useTracking.ts
```

**Acceptance Criteria**:
- âœ“ Báº£ng tracking hiá»ƒn thá»‹ Ä‘áº§y Ä‘á»§ thÃ´ng tin
- âœ“ Filter theo há»c ká»³/mÃ´n
- âœ“ Search há»c viÃªn
- âœ“ Pagination hoáº¡t Ä‘á»™ng

---

### 4.2 Cáº­p nháº­t sá»‘ buá»•i/dá»± Ã¡n hoÃ n thÃ nh (Priority: HIGH)

**MÃ´ táº£**: Admin cáº­p nháº­t tiáº¿n Ä‘á»™ thá»§ cÃ´ng

**Subtasks**:
- [ ] Inline edit sá»‘ buá»•i hoÃ n thÃ nh
- [ ] Inline edit sá»‘ dá»± Ã¡n hoÃ n thÃ nh
- [ ] ThÃªm/sá»­a link káº¿t quáº£ dá»± Ã¡n
- [ ] Auto-save khi thay Ä‘á»•i
- [ ] Validation (khÃ´ng vÆ°á»£t quÃ¡ yÃªu cáº§u)
- [ ] History log thay Ä‘á»•i (optional)

**UI - Inline Edit**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tráº§n Thá»‹ B â”‚ [8 â–¼]/10 â”‚ [1 â–¼]/2 â”‚ [+ ThÃªm link] â”‚ ğŸ”„ Äang há»c      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â†“ Click Ä‘á»ƒ edit
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Tráº§n Thá»‹ B â”‚ [10â–¼]/10 â”‚ [2 â–¼]/2 â”‚ [Link 1][Link 2] â”‚ â³ Chá» duyá»‡t â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Acceptance Criteria**:
- âœ“ Edit sá»‘ buá»•i inline
- âœ“ Edit sá»‘ dá»± Ã¡n inline
- âœ“ ThÃªm link káº¿t quáº£
- âœ“ Auto-save

---

### 4.3 Logic pass mÃ´n (Priority: HIGH)

**MÃ´ táº£**: Äiá»u kiá»‡n Ä‘á»ƒ há»c viÃªn pass mÃ´n

**Äiá»u kiá»‡n Pass**:
```
Pass mÃ´n = Äá»§ buá»•i + Äá»§ dá»± Ã¡n + CÃ³ link káº¿t quáº£

Cá»¥ thá»ƒ:
- completedSessions >= requiredSessions (10/10)
- projectsSubmitted >= requiredProjects (2/2)
- CÃ³ Ã­t nháº¥t 1 link káº¿t quáº£ dá»± Ã¡n
```

**Subtasks**:
- [ ] Function kiá»ƒm tra Ä‘iá»u kiá»‡n pass
- [ ] Auto-detect khi Ä‘á»§ Ä‘iá»u kiá»‡n â†’ status = 'pending_approval'
- [ ] Button "Duyá»‡t Pass" cho admin
- [ ] Button "Tá»« chá»‘i" vá»›i lÃ½ do
- [ ] Notification cho há»c viÃªn khi Ä‘Æ°á»£c duyá»‡t

**Status Flow**:
```
not_started â†’ in_progress â†’ pending_approval â†’ completed
                                    â†“
                               rejected (vá»›i lÃ½ do)
```

**Implementation**:
```typescript
function checkPassCondition(
  progress: StudentProgress,
  course: Course
): { canPass: boolean; reasons: string[] } {
  const reasons: string[] = [];
  
  if (progress.completedSessions < course.requiredSessions) {
    reasons.push(`ChÆ°a Ä‘á»§ buá»•i: ${progress.completedSessions}/${course.requiredSessions}`);
  }
  
  if (progress.projectsSubmitted < course.requiredProjects) {
    reasons.push(`ChÆ°a Ä‘á»§ dá»± Ã¡n: ${progress.projectsSubmitted}/${course.requiredProjects}`);
  }
  
  // Check cÃ³ link káº¿t quáº£ khÃ´ng
  // ...
  
  return {
    canPass: reasons.length === 0,
    reasons,
  };
}
```

**Acceptance Criteria**:
- âœ“ Tá»± Ä‘á»™ng detect Ä‘á»§ Ä‘iá»u kiá»‡n
- âœ“ Admin duyá»‡t/tá»« chá»‘i
- âœ“ Hiá»ƒn thá»‹ lÃ½ do náº¿u chÆ°a Ä‘á»§

---

### 4.4 Quick Track - Bulk Pass (Priority: MEDIUM)

**MÃ´ táº£**: Admin pass nhanh nhiá»u há»c viÃªn cÃ¹ng lÃºc

**Subtasks**:
- [ ] Tab "Quick Track" trong trang tracking
- [ ] Checkbox chá»n nhiá»u há»c viÃªn
- [ ] Select all / Deselect all
- [ ] Button "Pass táº¥t cáº£ Ä‘Ã£ chá»n"
- [ ] Confirm dialog trÆ°á»›c khi pass
- [ ] Progress indicator khi processing
- [ ] Report káº¿t quáº£

**UI Layout**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Tracking] [Quick Track]                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  MÃ´n há»c: [Design Fundamentals â–¼]                                   â”‚
â”‚                                                                      â”‚
â”‚  Hiá»ƒn thá»‹: Há»c viÃªn Ä‘á»§ Ä‘iá»u kiá»‡n pass (chÆ°a Ä‘Æ°á»£c duyá»‡t)            â”‚
â”‚                                                                      â”‚
â”‚  [â˜‘ Chá»n táº¥t cáº£]                          [Pass X há»c viÃªn Ä‘Ã£ chá»n] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜‘ â”‚ Há»c viÃªn        â”‚ Buá»•i  â”‚ Dá»± Ã¡n â”‚ Link káº¿t quáº£                 â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜‘ â”‚ Nguyá»…n VÄƒn A    â”‚ 10/10 â”‚ 2/2   â”‚ âœ“ CÃ³                         â”‚
â”‚ â˜‘ â”‚ LÃª VÄƒn C        â”‚ 10/10 â”‚ 2/2   â”‚ âœ“ CÃ³                         â”‚
â”‚ â˜ â”‚ HoÃ ng Thá»‹ E     â”‚ 10/10 â”‚ 2/2   â”‚ âœ“ CÃ³                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Acceptance Criteria**:
- âœ“ Chá»n nhiá»u há»c viÃªn
- âœ“ Bulk pass hoáº¡t Ä‘á»™ng
- âœ“ Confirm trÆ°á»›c khi pass
- âœ“ Report káº¿t quáº£

---

### 4.5 Má»Ÿ khÃ³a mÃ´n/há»c ká»³ tiáº¿p theo (Priority: HIGH)

**MÃ´ táº£**: Tá»± Ä‘á»™ng má»Ÿ khÃ³a khi hoÃ n thÃ nh

**Logic má»Ÿ khÃ³a**:
```
Má»Ÿ mÃ´n tiáº¿p theo:
- Khi pass mÃ´n hiá»‡n táº¡i
- MÃ´n tiáº¿p theo theo order trong há»c ká»³

Má»Ÿ há»c ká»³ tiáº¿p theo:
- Khi pass Táº¤T Cáº¢ mÃ´n trong há»c ká»³ hiá»‡n táº¡i
- Há»c ká»³ tiáº¿p theo theo order
```

**Subtasks**:
- [ ] Function kiá»ƒm tra Ä‘iá»u kiá»‡n má»Ÿ khÃ³a
- [ ] Trigger khi pass mÃ´n
- [ ] Cáº­p nháº­t status mÃ´n tiáº¿p theo: locked â†’ not_started
- [ ] Cáº­p nháº­t currentSemesterId cá»§a student náº¿u cáº§n
- [ ] Notification cho há»c viÃªn

**Implementation**:
```typescript
async function unlockNextCourse(studentId: string, completedCourseId: string) {
  // 1. Láº¥y thÃ´ng tin mÃ´n vá»«a hoÃ n thÃ nh
  const completedCourse = await getCourse(completedCourseId);
  
  // 2. TÃ¬m mÃ´n tiáº¿p theo trong cÃ¹ng há»c ká»³
  const nextCourse = await getNextCourse(completedCourse.semesterId, completedCourse.order);
  
  if (nextCourse) {
    // 3. Má»Ÿ khÃ³a mÃ´n tiáº¿p theo
    await updateProgress(studentId, nextCourse.id, { status: 'not_started' });
  } else {
    // 4. ÄÃ£ háº¿t mÃ´n trong há»c ká»³, check má»Ÿ há»c ká»³ tiáº¿p
    await checkUnlockNextSemester(studentId, completedCourse.semesterId);
  }
}

async function checkUnlockNextSemester(studentId: string, semesterId: string) {
  // 1. Kiá»ƒm tra táº¥t cáº£ mÃ´n trong há»c ká»³ Ä‘Ã£ completed chÆ°a
  const allCompleted = await checkAllCoursesCompleted(studentId, semesterId);
  
  if (allCompleted) {
    // 2. Láº¥y há»c ká»³ tiáº¿p theo
    const nextSemester = await getNextSemester(semesterId);
    
    if (nextSemester) {
      // 3. Cáº­p nháº­t currentSemesterId
      await updateStudent(studentId, { currentSemesterId: nextSemester.id });
      
      // 4. Má»Ÿ khÃ³a mÃ´n Ä‘áº§u tiÃªn cá»§a há»c ká»³ má»›i
      const firstCourse = await getFirstCourse(nextSemester.id);
      await updateProgress(studentId, firstCourse.id, { status: 'not_started' });
    }
  }
}
```

**Acceptance Criteria**:
- âœ“ Tá»± Ä‘á»™ng má»Ÿ mÃ´n tiáº¿p theo khi pass
- âœ“ Tá»± Ä‘á»™ng má»Ÿ há»c ká»³ tiáº¿p theo khi hoÃ n thÃ nh táº¥t cáº£ mÃ´n
- âœ“ Student tháº¥y mÃ´n/há»c ká»³ má»›i Ä‘Æ°á»£c má»Ÿ

---

## Firestore Updates

```
/progress/{progressId}
  + status: 'not_started' | 'in_progress' | 'pending_approval' | 'completed' | 'rejected'
  + rejectionReason: string (optional)
  + approvedAt: timestamp (optional)
  + approvedBy: string (admin userId)

/trackingLogs/{logId}  (optional - for audit)
  - studentId
  - courseId
  - action: 'update_sessions' | 'update_projects' | 'approve' | 'reject'
  - previousValue
  - newValue
  - performedBy: admin userId
  - performedAt: timestamp
```

---

## Checklist hoÃ n thÃ nh Phase 4

- [ ] Báº£ng tracking hiá»ƒn thá»‹ Ä‘áº§y Ä‘á»§
- [ ] Filter vÃ  search hoáº¡t Ä‘á»™ng
- [ ] Inline edit sá»‘ buá»•i/dá»± Ã¡n
- [ ] Logic pass mÃ´n Ä‘Ãºng
- [ ] Admin duyá»‡t/tá»« chá»‘i
- [ ] Quick Track bulk pass
- [ ] Tá»± Ä‘á»™ng má»Ÿ khÃ³a mÃ´n tiáº¿p theo
- [ ] Tá»± Ä‘á»™ng má»Ÿ khÃ³a há»c ká»³ tiáº¿p theo
- [ ] Notification cho há»c viÃªn

---

## Notes

- Tracking lÃ  tÃ­nh nÄƒng core, cáº§n test ká»¹
- CÃ¢n nháº¯c thÃªm audit log cho compliance
- Quick Track giÃºp admin tiáº¿t kiá»‡m thá»i gian
- Unlock logic cáº§n handle edge cases (mÃ´n cuá»‘i, há»c ká»³ cuá»‘i)
